{% extends 'evaluaciones/base.html' %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row">
        <div class="col-md-12 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="mb-0">Detalle del Docente</h2>
                <span class="badge bg-primary">{{ docente.carrera.nombre|default:"Carrera no especificada" }}</span>
            </div>
            
            <!-- GRÁFICAS DE EVALUACIÓN (PRIMER VISTAMIENTO) -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white" style="background: linear-gradient(90deg, #4e73df 0%, #36b9cc 100%);">
                    <h4 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Resumen Visual de Evaluaciones</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 d-flex flex-column align-items-center">
                            <h5 class="text-center text-primary">Departamental</h5>
                            <canvas id="graficaDepartamental" width="320" height="220"></canvas>
                        </div>
                        <div class="col-md-4 d-flex flex-column align-items-center">
                            <h5 class="text-center text-info">Autoevaluación</h5>
                            <canvas id="graficaAuto" width="320" height="220"></canvas>
                        </div>
                        <div class="col-md-4 d-flex flex-column align-items-center">
                            <h5 class="text-center text-secondary">Alumnos</h5>
                            <canvas id="graficaAlumno" width="320" height="220"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Información Básica del Docente -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h4 class="mb-0"><i class="fas fa-user-tie me-2"></i>Información del Docente</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <h5 class="text-muted mb-2">Nombre completo</h5>
                                <p class="lead">{{ docente.user.get_full_name }}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <h5 class="text-muted mb-2">RFC</h5>
                                <p class="lead">{{ docente.rfc }}</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <h5 class="text-muted mb-2">Número de empleado</h5>
                                <p class="lead">{{ docente.numero_empleado|default:"No especificado" }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Materias y Alumnos -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-book me-2"></i>Materias que imparte</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                {% for materia in materias %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ materia.nombre }}
                                    <span class="badge bg-secondary">{{ materia.grupo }}</span>
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-header bg-light">
                            <h5 class="mb-0"><i class="fas fa-users me-2"></i>Alumnos en sus clases</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                {% for alumno in alumnos %}
                                <li class="list-group-item">{{ alumno.user.get_full_name }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Periodo Académico -->
            <div class="card shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h4 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Periodo Académico</h4>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="text-muted mb-2">Periodo actual</h5>
                            <p class="lead">{{ periodo.nombre }}</p>
                        </div>
                        <div class="col-md-6">
                            <h5 class="text-muted mb-2">Semestre</h5>
                            <p class="lead">{{ semestre }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Evaluaciones -->
            <div class="card shadow-sm">
                <div class="card-header bg-light">
                    <h4 class="mb-0"><i class="fas fa-chart-line me-2"></i>Resultados de Evaluación</h4>
                </div>
                <div class="card-body">
                    <!-- Evaluación Departamental -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">Evaluación Departamental</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td class="fw-semibold">Docencia</td>
                                            <td class="text-end">4.80/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Tutoría</td>
                                            <td class="text-end">4.65/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Investigación</td>
                                            <td class="text-end">4.50/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Vinculación</td>
                                            <td class="text-end">4.30/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Gestión</td>
                                            <td class="text-end">4.75/5.00</td>
                                        </tr>
                                        <tr class="table-primary">
                                            <td class="fw-bold">Resultado final</td>
                                            <td class="text-end fw-bold">4.60/5.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Autoevaluación -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">Autoevaluación</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td class="fw-semibold">Docencia</td>
                                            <td class="text-end">4.90/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Tutoría</td>
                                            <td class="text-end">4.70/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Investigación</td>
                                            <td class="text-end">4.60/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Vinculación</td>
                                            <td class="text-end">4.40/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Gestión</td>
                                            <td class="text-end">4.80/5.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Evaluación por Alumnos -->
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5 class="mb-0">Evaluación por Alumnos</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td class="fw-semibold">Dominio de asignatura</td>
                                            <td class="text-end">4.75/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Planificación del curso</td>
                                            <td class="text-end">4.50/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Ambientes de aprendizaje</td>
                                            <td class="text-end">4.60/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Estrategias, métodos y técnicas</td>
                                            <td class="text-end">4.80/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Motivación</td>
                                            <td class="text-end">4.65/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Evaluación</td>
                                            <td class="text-end">4.70/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Comunicación</td>
                                            <td class="text-end">4.85/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Gestión del curso</td>
                                            <td class="text-end">4.55/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Tecnologías de información</td>
                                            <td class="text-end">4.90/5.00</td>
                                        </tr>
                                        <tr>
                                            <td class="fw-semibold">Satisfacción general</td>
                                            <td class="text-end">4.75/5.00</td>
                                        </tr>
                                        <tr class="table-primary">
                                            <td class="fw-bold">Promedio general</td>
                                            <td class="text-end fw-bold">4.70/5.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Resumen Final -->
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">Resumen General</h5>
                        </div>
                        <div class="card-body">
                            <div class="progress mb-3" style="height: 30px;">
                                <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" 
                                     role="progressbar" 
                                     style="width: 87.5%"
                                     aria-valuenow="87.5" 
                                     aria-valuemin="0" 
                                     aria-valuemax="100">
                                    <span class="fs-5 fw-bold">87.5%</span>
                                </div>
                            </div>
                            <p class="text-center text-muted mb-0">Promedio ponderado de todas las evaluaciones</p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Gráfica Departamental
    new Chart(document.getElementById('graficaDepartamental').getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Docencia', 'Tutoría', 'Investigación', 'Vinculación', 'Gestión'],
            datasets: [{
                label: 'Puntaje',
                data: [4.80, 4.65, 4.50, 4.30, 4.75],
                backgroundColor: '#1cc88a'
            }]
        },
        options: {
            responsive: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, max: 5 } }
        }
    });

    // Gráfica Autoevaluación
    new Chart(document.getElementById('graficaAuto').getContext('2d'), {
        type: 'bar',
        data: {
            labels: ['Docencia', 'Tutoría', 'Investigación', 'Vinculación', 'Gestión'],
            datasets: [{
                label: 'Puntaje',
                data: [4.90, 4.70, 4.60, 4.40, 4.80],
                backgroundColor: '#36b9cc'
            }]
        },
        options: {
            responsive: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, max: 5 } }
        }
    });

    // Gráfica Evaluación por Alumnos
    new Chart(document.getElementById('graficaAlumno').getContext('2d'), {
        type: 'bar',
        data: {
            labels: [
                'Dominio', 'Planificación', 'Ambientes', 'Estrategias', 'Motivación',
                'Evaluación', 'Comunicación', 'Gestión', 'TI', 'Satisfacción'
            ],
            datasets: [{
                label: 'Puntaje',
                data: [4.75, 4.50, 4.60, 4.80, 4.65, 4.70, 4.85, 4.55, 4.90, 4.75],
                backgroundColor: '#4e73df'
            }]
        },
        options: {
            responsive: false,
            plugins: { legend: { display: false } },
            scales: { y: { beginAtZero: true, max: 5 } }
        }
    });
</script>
<script>
    function exportarPDF() {
        // Selecciona el contenido que quieres exportar (puedes ajustar el selector si quieres solo una parte)
        var element = document.querySelector('.container-fluid');
        var opt = {
            margin:       0.2,
            filename:     'detalle_docente.pdf',
            image:        { type: 'jpeg', quality: 0.98 },
            html2canvas:  { scale: 2, useCORS: true },
            jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        html2pdf().set(opt).from(element).save();
    }
</script>
<button class="btn btn-danger mb-3 d-print-none" onclick="exportarPDF()">
    <i class="fas fa-file-pdf me-2"></i>Exportar a PDF
</button>
{% endblock %}